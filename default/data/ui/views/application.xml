<dashboard script="code_application.js" stylesheet="style.css">
  
  <label>Application</label>
  
  <search id="token_search_create" depends="$token_create_application_id$,
      $token_create_name$">

    <query>
      | inputlookup kvs_scmdb_application 
      | append [ stats count
        | eval application_id="$token_create_application_id$" 
        | eval name="$token_create_name$" 
        | eval created_date=now()
        | eval updated_date=now()
        | eval created_user="$env:user$"
        | eval updated_user="$env:user$"]
      | table application_id, name, created_date, updated_date, created_user, updated_user
      | outputlookup kvs_scmdb_application
    </query>  
  </search>


  <search id="token_search_update" depends="$token_update_key$, 
      $token_update_application_id$,
      $token_update_name$">
    <query>
      | inputlookup kvs_scmdb_application 
      | eval key=_key 
      | WHERE key="$token_update_key$" 
      | eval application_id="$token_update_application_id$"
      | eval name="$token_update_name$"
      | eval updated_date=now()
      | eval updated_user="$env:user$"
      | outputlookup kvs_scmdb_application append=t
    </query>  
  </search>
  
    
  <search id="token_search_delete" depends="$token_delete_key$">
    <query>
      | inputlookup kvs_scmdb_application
      | eval key=_key
      | WHERE NOT key="$token_delete_key$"
      | outputlookup kvs_scmdb_application
    </query>
  </search>


  <!-- Top selector drop downs -->

  <!-- Drop down Category -->
  <fieldset submitButton="false">
    <!-- Drop down selector for Requirement ID -->
    <input type="dropdown" token="token_select_requirement_id" searchWhenChanged="true">
      <label>Requirement ID:</label>
      <fieldForLabel>requirement_id</fieldForLabel>
      <fieldForValue>requirement_id</fieldForValue>
      <search>
        <query>| inputlookup kvs_splunk_requirement | dedup requirement_id | sort requirement_id | table requirement_id</query>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </search>
      <choice value="*">All</choice>
      <initialValue>*</initialValue>
      <prefix>"</prefix>
      <suffix>"</suffix>
      <default>*</default>
    </input>

    <!-- In the search SPL add prefix with "* and suffix with *"; so search valiue will be "*text to search*" -->
    <input type="text" token="token_search_description" searchWhenChanged="true">
      <label>Search description:</label>
      <default>*</default>
      <initialValue>*</initialValue>
       <prefix>"*</prefix>
      <suffix>*"</suffix>
    </input>

    <!-- Drop down selector for Category -->
    <input type="dropdown" token="token_select_category" searchWhenChanged="true">
      <label>Category:</label>
      <fieldForLabel>category</fieldForLabel>
      <fieldForValue>category</fieldForValue>
      <search>
        <query>| inputlookup kvs_splunk_requirement | dedup category | sort category | table category</query>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </search>
      <choice value="*">All</choice>
      <initialValue>*</initialValue>
      <prefix>"</prefix>
      <suffix>"</suffix>
      <default>*</default>
    </input>

    <!-- Drop down selector for Accepted -->
    <input type="dropdown" token="token_select_accepted" searchWhenChanged="true">
      <label>PO Acceptance:</label>
      <choice value="*">All</choice>
      <default>*</default>
      <initialValue>*</initialValue>
      <fieldForLabel>accepted</fieldForLabel>
      <fieldForValue>accepted</fieldForValue>
      <search>
        <query>| inputlookup kvs_splunk_requirement | dedup accepted | sort accepted | table accepted</query>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </search>
    </input>

    <!-- Drop down selector for Priority -->
    <input type="dropdown" token="token_select_priority" searchWhenChanged="true">
      <label>PO Priority:</label>
      <choice value="*">All</choice>
      <default>*</default>
      <initialValue>*</initialValue>
      <fieldForLabel>priority</fieldForLabel>
      <fieldForValue>priority</fieldForValue>
      <search>
        <query>| inputlookup kvs_splunk_requirement | dedup priority | sort priority | table priority</query>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </search>
    </input>

    <!-- Drop down selector for Phase -->
    <input type="dropdown" token="token_select_phase" searchWhenChanged="true">
      <label>PO Phase:</label>
      <choice value="*">All</choice>
      <default>*</default>
      <initialValue>*</initialValue>
      <fieldForLabel>phase</fieldForLabel>
      <fieldForValue>phase</fieldForValue>
      <search>
        <query>| inputlookup kvs_splunk_requirement | dedup phase | sort phase | table phase</query>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </search>
    </input>

    <!-- Drop down selector for Status -->
    <input type="dropdown" token="token_select_status" searchWhenChanged="true">
      <label>Supplier Status:</label>
      <choice value="*">All</choice>
      <default>*</default>
      <initialValue>*</initialValue>
      <fieldForLabel>status</fieldForLabel>
      <fieldForValue>status</fieldForValue>
      <search>
        <query>| inputlookup kvs_splunk_requirement | dedup status | sort status | table status</query>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </search>
    </input>
  </fieldset>

  <row>
    <!-- Right side of the dashboard where the list of all requirements is -->
    <panel id="token_panel_collection">
      <table id="token_table_collection">
        <title>Splunk Requirement</title>
        <search id="token_search_collection">
          <!-- Use search in SPL to use phase=*, will not work with where clause --> 
          <query>
            | inputlookup kvs_scmdb_application  
            | eval Update="Update" 
            | eval Delete="Delete" 
            | table application_id, Update, Delete, name, *
            | sort name
          </query>
          <earliest>0</earliest>
          <latest></latest>
        </search>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">true</option>
        <option name="wrap">false</option>
        <option name="count">20</option>
        <format type="color" field="Delete">
          <colorPalette type="map">{"Delete":#b22222}</colorPalette>
        </format>
        <format type="color" field="Update">
          <colorPalette type="map">{"Update":#228b22}</colorPalette>
        </format>

      </table>
    </panel>
    <!-- Left side of the dashboard where the form is -->
     <panel id="token_panel_form">
      <html>
        <form>
          <h1>Application Form</h1>

            <!-- Hidden input for KV Store key field -->
            <input type="hidden" name="_key"/>

            <div>
          	  <label for="label_application_id">Application ID:</label>
              <input style="width: 35%" type="text" name="name_application_id"/>
            </div>

            <div>
          	  <label for="label_name">Name:</label>
              <textarea rows="5" cols="95%" name = "name_name"/>
            </div>

            
          <div>
            <p style="text-align:right">
              <button class="button button4" id="id_button_submit">Submit</button>
            </p> <!-- Alignment of the button to the right of the column -->
          </div>
        </form>
      </html>
    </panel>
  </row>
</dashboard>